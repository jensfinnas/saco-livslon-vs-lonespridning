(function(){var n,t;n=function(){function n(n,t){var i,r;if(this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:!0,mock:!1,useHttp:!1},typeof n=="object")for(i in n)r=n[i],this.options[i]=r;this.context=t!=null?t:this;this.unique=this._genKey()}return n.prototype.hasNext=function(){return typeof this.context.nextUrl=="string"&&this.context.nextUrl.length>0},n.prototype.next=function(){return this.hasNext()?this.run(this.context.nextUrl):!1},n.prototype.run=function(t){var u,r,i;if(typeof this.options.clientId!="string"&&typeof this.options.accessToken!="string")throw new Error("Missing clientId or accessToken.");if(typeof this.options.accessToken!="string"&&typeof this.options.clientId!="string")throw new Error("Missing clientId or accessToken.");return this.options.before!=null&&typeof this.options.before=="function"&&this.options.before.call(this),typeof document!="undefined"&&document!==null&&(i=document.createElement("script"),i.id="instafeed-fetcher",i.src=t||this._buildUrl(),u=document.getElementsByTagName("head"),u[0].appendChild(i),r="instafeedCache"+this.unique,window[r]=new n(this.options,this),window[r].unique=this.unique),!0},n.prototype.parse=function(n){var f,u,b,l,t,a,r,i,e,tt,v,k,o,y,p,s,h,c,d,g,nt,w;if(typeof n!="object"){if(this.options.error!=null&&typeof this.options.error=="function")return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response");}if(n.meta.code!==200){if(this.options.error!=null&&typeof this.options.error=="function")return this.options.error.call(this,n.meta.error_message),!1;throw new Error("Error from Instagram: "+n.meta.error_message);}if(n.data.length===0){if(this.options.error!=null&&typeof this.options.error=="function")return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram");}if(this.options.success!=null&&typeof this.options.success=="function"&&this.options.success.call(this,n),this.context.nextUrl="",n.pagination!=null&&(this.context.nextUrl=n.pagination.next_url),this.options.sortBy!=="none"){y=this.options.sortBy==="random"?["","random"]:this.options.sortBy.split("-");o=y[0]==="least"?!0:!1;switch(y[1]){case"random":n.data.sort(function(){return.5-Math.random()});break;case"recent":n.data=this._sortBy(n.data,"created_time",o);break;case"liked":n.data=this._sortBy(n.data,"likes.count",o);break;case"commented":n.data=this._sortBy(n.data,"comments.count",o);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.");}}if(typeof document!="undefined"&&document!==null&&this.options.mock===!1){if(i=n.data,this.options.limit!=null&&i.length>this.options.limit&&(i=i.slice(0,this.options.limit+1||9e9)),u=document.createDocumentFragment(),this.options.filter!=null&&typeof this.options.filter=="function"&&(i=this._filter(i,this.options.filter)),this.options.template!=null&&typeof this.options.template=="string"){for(l="",a="",tt="",p=document.createElement("div"),s=0,d=i.length;s<d;s++)t=i[s],r=t.images[this.options.resolution].url,this.options.useHttp||(r=r.replace("http://","//")),a=this._makeTemplate(this.options.template,{model:t,id:t.id,link:t.link,image:r,caption:this._getObjectProperty(t,"caption.text"),likes:t.likes.count,comments:t.comments.count,location:this._getObjectProperty(t,"location.name")}),l+=a;for(p.innerHTML=l,w=[].slice.call(p.childNodes),h=0,g=w.length;h<g;h++)k=w[h],u.appendChild(k)}else for(c=0,nt=i.length;c<nt;c++)t=i[c],e=document.createElement("img"),r=t.images[this.options.resolution].url,this.options.useHttp||(r=r.replace("http://","//")),e.src=r,this.options.links===!0?(f=document.createElement("a"),f.href=t.link,f.appendChild(e),u.appendChild(f)):u.appendChild(e);document.getElementById(this.options.target).appendChild(u);b=document.getElementsByTagName("head")[0];b.removeChild(document.getElementById("instafeed-fetcher"));v="instafeedCache"+this.unique;window[v]=void 0;try{delete window[v]}catch(it){}}return this.options.after!=null&&typeof this.options.after=="function"&&this.options.after.call(this),!0},n.prototype._buildUrl=function(){var i,n,t;i="https://api.instagram.com/v1";switch(this.options.get){case"popular":n="media/popular";break;case"tagged":if(typeof this.options.tagName!="string")throw new Error("No tag name specified. Use the 'tagName' option.");n="tags/"+this.options.tagName+"/media/recent";break;case"location":if(typeof this.options.locationId!="number")throw new Error("No location specified. Use the 'locationId' option.");n="locations/"+this.options.locationId+"/media/recent";break;case"user":if(typeof this.options.userId!="number")throw new Error("No user specified. Use the 'userId' option.");if(typeof this.options.accessToken!="string")throw new Error("No access token. Use the 'accessToken' option.");n="users/"+this.options.userId+"/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.");}return t=""+i+"/"+n,t+=this.options.accessToken!=null?"?access_token="+this.options.accessToken:"?client_id="+this.options.clientId,this.options.limit!=null&&(t+="&count="+this.options.limit),t+="&callback=instafeedCache"+this.unique+".parse",t},n.prototype._genKey=function(){var n;return n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},""+n()+n()+n()+n()},n.prototype._makeTemplate=function(n,t){for(var u,f,e,r=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,i=n;r.test(i);)u=i.match(r)[1],f=(e=this._getObjectProperty(t,u))!=null?e:"",i=i.replace(r,""+f);return i},n.prototype._getObjectProperty=function(n,t){var i,r;for(t=t.replace(/\[(\w+)\]/g,".$1"),r=t.split(".");r.length;){if(i=r.shift(),!(n!=null&&i in n))return null;n=n[i]}return n},n.prototype._sortBy=function(n,t,i){var r;return r=function(n,r){var u,f;return u=this._getObjectProperty(n,t),f=this._getObjectProperty(r,t),i?u>f?1:-1:u<f?1:-1},n.sort(r.bind(this)),n},n.prototype._filter=function(n,t){var r,u,f,i,e;for(r=[],f=function(n){if(t(n))return r.push(n)},i=0,e=n.length;i<e;i++)u=n[i],f(u);return r},n}();t=typeof exports!="undefined"&&exports!==null?exports:window;t.Instafeed=n}).call(this)